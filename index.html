<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Macloreina NFT Mint</title>
</head>
<body>
  <h1>ğŸƒ Mint Your NFT</h1>
  <p>Enter your IPFS CID (e.g. <code>bafybeiev2y...</code>):</p>
  <input type="text" id="imageURI" placeholder="Enter IPFS CID here" style="width: 300px;" />
  <br/><br/>
  <button onclick="mintCard()">Mint NFT (0.001 ETH)</button>
  <br/><br/>
  <pre id="status">Not minted yet.</pre>

  <!-- å¼•å…¥ ethers.js åº“ -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.6.2/dist/ethers.min.js"></script>
  <script>
    const CONTRACT_ADDRESS = "0x9D7f74d0C41E726EC95884E0e97Fa6129e3b5E99"; // æ›¿æ¢ä¸ºä½ è‡ªå·±çš„åˆçº¦åœ°å€

    // æ›¿æ¢ä¸ºä½ è‡ªå·±çš„ ABIï¼ˆä¸‹é¢è¿™ä¸ªæ˜¯æˆ‘ä¸ºä½ å†™çš„æ ‡å‡† mintCard(string) ç‰ˆæœ¬ï¼‰
    const CONTRACT_ABI = [
      {
        "inputs": [
          {
            "internalType": "string",
            "name": "imageURI",
            "type": "string"
          }
        ],
        "name": "mintCard",
        "outputs": [],
        "stateMutability": "payable",
        "type": "function"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": true,
            "internalType": "address",
            "name": "from",
            "type": "address"
          },
          {
            "indexed": true,
            "internalType": "address",
            "name": "to",
            "type": "address"
          },
          {
            "indexed": true,
            "internalType": "uint256",
            "name": "tokenId",
            "type": "uint256"
          }
        ],
        "name": "Transfer",
        "type": "event"
      }
    ];

    async function mintCard() {
      const imageCID = document.getElementById("imageURI").value.trim();
      const imageURI = "ipfs://" + imageCID;

      if (!window.ethereum) {
        alert("Please install MetaMask first.");
        return;
      }

      const provider = new ethers.BrowserProvider(window.ethereum);
      const signer = await provider.getSigner();
      const contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);

      try {
        document.getElementById("status").innerText = "â³ Sending transaction...";
        const tx = await contract.mintCard(imageURI, {
          value: ethers.parseEther("0.001")
        });

        const receipt = await tx.wait();
        const tokenId = receipt.logs[0].args[2].toString();

        const explorer = `https://sepolia.etherscan.io/tx/${tx.hash}`;

        document.getElementById("status").innerText =
          `âœ… Minted Successfully!\n\nğŸ†” Token ID: ${tokenId}\nğŸ“¦ Transaction: ${explorer}\nğŸ–¼ï¸ Image: ${imageURI}`;
      } catch (error) {
        console.error(error);
        document.getElementById("status").innerText = `âŒ Mint failed: ${error.message}`;
      }
    }
  </script>
</body>
</html>
